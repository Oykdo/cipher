<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clear Local Data - Cipher Pulse</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      color: #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    .container {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 40px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }
    h1 {
      margin: 0 0 10px 0;
      font-size: 24px;
      color: #f1f5f9;
    }
    p {
      color: #94a3b8;
      margin: 0 0 30px 0;
      line-height: 1.6;
    }
    .warning {
      background: #7f1d1d;
      border: 1px solid #991b1b;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 30px;
    }
    .warning-title {
      color: #fca5a5;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .warning-text {
      color: #fecaca;
      font-size: 14px;
      margin: 0;
    }
    .btn {
      width: 100%;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 12px;
    }
    .btn-danger {
      background: #dc2626;
      color: white;
    }
    .btn-danger:hover {
      background: #b91c1c;
    }
    .btn-secondary {
      background: #475569;
      color: white;
    }
    .btn-secondary:hover {
      background: #334155;
    }
    .status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }
    .status.success {
      background: #065f46;
      border: 1px solid #047857;
      color: #6ee7b7;
      display: block;
    }
    .status.error {
      background: #7f1d1d;
      border: 1px solid #991b1b;
      color: #fca5a5;
      display: block;
    }
    .items-list {
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      font-size: 14px;
    }
    .items-list h3 {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: #94a3b8;
    }
    .items-list ul {
      margin: 0;
      padding-left: 20px;
      color: #cbd5e1;
    }
    .items-list li {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üóëÔ∏è Nettoyer les donn√©es locales</h1>
    <p>Cette page permet de supprimer toutes les donn√©es stock√©es localement dans votre navigateur pour Cipher Pulse.</p>

    <div class="warning">
      <div class="warning-title">‚ö†Ô∏è Attention</div>
      <p class="warning-text">
        Cette action supprimera d√©finitivement toutes vos donn√©es locales, y compris vos sessions actives. Vous devrez vous reconnecter.
      </p>
    </div>

    <div class="items-list">
      <h3>Donn√©es qui seront supprim√©es :</h3>
      <ul>
        <li>localStorage (sessions, pr√©f√©rences)</li>
        <li>sessionStorage (donn√©es temporaires)</li>
        <li>IndexedDB (CipherPulseSecure, cl√©s chiffr√©es)</li>
        <li>Cookies (tokens d'authentification)</li>
        <li>Cache du service worker</li>
      </ul>
    </div>

    <button class="btn btn-danger" onclick="clearAllData()">
      Supprimer toutes les donn√©es
    </button>

    <button class="btn btn-secondary" onclick="window.location.href='/'">
      Annuler
    </button>

    <div id="status" class="status"></div>
  </div>

  <script>
    async function clearAllData() {
      const statusEl = document.getElementById('status');
      const results = [];

      try {
        // 1. Clear localStorage
        try {
          const localStorageCount = localStorage.length;
          localStorage.clear();
          results.push(`‚úì localStorage cleared (${localStorageCount} items)`);
        } catch (e) {
          results.push(`‚úó localStorage error: ${e.message}`);
        }

        // 2. Clear sessionStorage
        try {
          const sessionStorageCount = sessionStorage.length;
          sessionStorage.clear();
          results.push(`‚úì sessionStorage cleared (${sessionStorageCount} items)`);
        } catch (e) {
          results.push(`‚úó sessionStorage error: ${e.message}`);
        }

        // 3. Clear IndexedDB
        try {
          const databases = await indexedDB.databases();
          for (const db of databases) {
            if (db.name) {
              await new Promise((resolve, reject) => {
                const request = indexedDB.deleteDatabase(db.name);
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
              });
              results.push(`‚úì IndexedDB "${db.name}" deleted`);
            }
          }
        } catch (e) {
          results.push(`‚úó IndexedDB error: ${e.message}`);
        }

        // 4. Clear cookies
        try {
          const cookies = document.cookie.split(';');
          for (const cookie of cookies) {
            const name = cookie.split('=')[0].trim();
            document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
          }
          results.push(`‚úì Cookies cleared (${cookies.length} cookies)`);
        } catch (e) {
          results.push(`‚úó Cookies error: ${e.message}`);
        }

        // 5. Clear cache
        try {
          if ('caches' in window) {
            const cacheNames = await caches.keys();
            for (const cacheName of cacheNames) {
              await caches.delete(cacheName);
            }
            results.push(`‚úì Cache cleared (${cacheNames.length} caches)`);
          }
        } catch (e) {
          results.push(`‚úó Cache error: ${e.message}`);
        }

        // 6. Unregister service workers
        try {
          if ('serviceWorker' in navigator) {
            const registrations = await navigator.serviceWorker.getRegistrations();
            for (const registration of registrations) {
              await registration.unregister();
            }
            results.push(`‚úì Service workers unregistered (${registrations.length})`);
          }
        } catch (e) {
          results.push(`‚úó Service worker error: ${e.message}`);
        }

        // Show success
        statusEl.className = 'status success';
        statusEl.innerHTML = `
          <strong>‚úÖ Donn√©es supprim√©es avec succ√®s !</strong><br><br>
          ${results.join('<br>')}
          <br><br>
          <button class="btn btn-secondary" onclick="window.location.href='/'">
            Retour √† l'accueil
          </button>
        `;

      } catch (error) {
        statusEl.className = 'status error';
        statusEl.innerHTML = `
          <strong>‚ùå Erreur lors de la suppression</strong><br><br>
          ${error.message}
          <br><br>
          ${results.join('<br>')}
        `;
      }
    }

    // Show current data on load
    window.addEventListener('load', () => {
      console.log('üìä Current local data:');
      console.log('localStorage items:', localStorage.length);
      console.log('sessionStorage items:', sessionStorage.length);
      console.log('cookies:', document.cookie.split(';').length);
    });
  </script>
</body>
</html>
